var __defProp=Object.defineProperty,__defProps=Object.defineProperties,__getOwnPropDescs=Object.getOwnPropertyDescriptors,__getOwnPropSymbols=Object.getOwnPropertySymbols,__hasOwnProp=Object.prototype.hasOwnProperty,__propIsEnum=Object.prototype.propertyIsEnumerable,__defNormalProp=(e,t,r)=>t in e?__defProp(e,t,{enumerable:!0,configurable:!0,writable:!0,value:r}):e[t]=r,__spreadValues=(e,t)=>{for(var r in t||(t={}))__hasOwnProp.call(t,r)&&__defNormalProp(e,r,t[r]);if(__getOwnPropSymbols)for(var r of __getOwnPropSymbols(t))__propIsEnum.call(t,r)&&__defNormalProp(e,r,t[r]);return e},__spreadProps=(e,t)=>__defProps(e,__getOwnPropDescs(t)),__objRest=(e,t)=>{var r={};for(var o in e)__hasOwnProp.call(e,o)&&t.indexOf(o)<0&&(r[o]=e[o]);if(null!=e&&__getOwnPropSymbols)for(var o of __getOwnPropSymbols(e))t.indexOf(o)<0&&__propIsEnum.call(e,o)&&(r[o]=e[o]);return r};!function(e,t){"object"==typeof exports&&"undefined"!=typeof module?module.exports=t(require("jsonschema"),require("vue")):"function"==typeof define&&define.amd?define(["jsonschema","vue"],t):(e="undefined"!=typeof globalThis?globalThis:e||self)["@unrest/form"]=t(e.jsonschema,e.Vue)}(this,(function(e,t){"use strict";const r=e=>{const t={};return Object.entries(e).forEach((([e,o])=>{if(null==o||""===o)return;if(o.constructor!==Object)return void(t[e]=o);const n=r(o);Object.keys(n).length>0&&(t[e]=n)})),t};const o=(e,t)=>"object"===t.type?(e=e||{},Object.entries(t.properties).forEach((([t,r])=>{e[t]=o(e[t],r)})),e):e||t.default;var n=e=>(e=e.replace(/([A-Z])/g," $1").toLowerCase().replace(/_/g," "))[0].toUpperCase()+e.slice(1);const l=["number","string","boolean"],a=e=>{if(null==e)return{};for(let t=0;t<l.length;t++)if(typeof e===l[t])return{default:e,type:l[t]};if(Array.isArray(e))return{type:"array",default:e,items:a(e[0])};if("lazy"===e.type){const t={};return Object.entries(e).forEach((([e,r])=>t[e]=a(r))),delete t.type,{type:"object",properties:t}}if(e.type)return e;throw"Unrecognized schema object for parseLazySchema"},s=e=>"object"===e.type?"unrest-object":e.enum?"unrest-select":"boolean"===e.type?"unrest-checkbox":"image"===e.type?"unrest-image":"color"===e.format?"unrest-color":"password"===e.format?"unrest-password":"unrest-text";var i=(e,t,{ui:r={}}={},o=[])=>{var l=__objRest(t,[]);return"lazy"===l.type&&(l=a(l)),l.name=e,l.id=`id__${l.name}`,l.ui=((e,t)=>{const r={type:"text",tagName:s(e)};return"number"===e.type&&(r.type="number"),"password"===e.format&&(r.type="password"),Object.assign(r,t[e.name],e.ui)})(l,r),void 0===l.title&&(l.title=n(l.name)),l.__path=o.slice(),"__root"!==e&&l.__path.push(l.name),l};const c={provide(){return{ur_form:this}},props:{schema:Object,uiSchema:Object,state:{type:Object,default:()=>({})},onSubmit:Function,onChange:Function,onInput:Function,errors:Object,focus:{type:Boolean,default:()=>!0},onCancel:Function},data:()=>({internal_errors:null}),computed:{computed_errors(){const e=__spreadValues(__spreadValues({},this.errors),this.internal_errors);return e.__all__&&(e.__root=e.__all__),e},prepped_schema(){return i("__root",this.schema)}},beforeMount(){o(this.state,this.prepped_schema)},mounted(){var e;this.focus&&(null==(e=this.$el.querySelector("input"))||e.focus())},methods:{handleError(e){var t,r,o,n;throw e.message&&(this.internal_errors={__root:e.message||e}),(null==(r=null==(t=e.response)?void 0:t.data)?void 0:r.errors)&&(this.internal_errors=null==(n=null==(o=e.response)?void 0:o.data)?void 0:n.errors),e},change(e){var t;null==(t=this.onChange)||t.call(this,this.state,e)},input(e){var t;null==(t=this.onInput)||t.call(this,this.state,e)},submit(t){var o;if(this.internal_errors=((t,o)=>{const n=e.validate(r(t),o);if(!n.errors.length)return null;const l={};return n.errors.forEach((({path:e,argument:t,message:r,name:o})=>{e=[...e,t],l[e.join(".")]="required"===o?"This field is required.":r})),l})(this.state,this.prepped_schema),!this.internal_errors)try{null==(o=this.onSubmit(this.state,t))||o.catch(this.handleError)}catch(n){this.handleError(n)}}}},u={class:"ur-form__actions"},d=t.createVNode("button",{type:"submit",class:"btn -primary"},"Submit",-1);c.render=function(e,r,o,n,l,a){var s;const i=t.resolveComponent("unrest-field");return t.openBlock(),t.createBlock("form",{onSubmit:r[3]||(r[3]=t.withModifiers(((...e)=>a.submit&&a.submit(...e)),["prevent"])),class:"ur-form"},[t.createVNode(i,{modelValue:o.state,"onUpdate:modelValue":r[1]||(r[1]=e=>o.state=e),field:a.prepped_schema,key:a.prepped_schema.id,onChange:a.change,onInput:a.input},null,8,["modelValue","field","onChange","onInput"]),(t.openBlock(!0),t.createBlock(t.Fragment,null,t.renderList(null==(s=a.computed_errors)?void 0:s.__root,((e,r)=>(t.openBlock(),t.createBlock("div",{key:r,class:"form-error"},t.toDisplayString(e.message),1)))),128)),t.createVNode("div",u,[t.renderSlot(e.$slots,"actions",{},(()=>[o.onCancel?(t.openBlock(),t.createBlock("div",{key:0,type:"cancel",class:"btn -secondary",onClick:r[2]||(r[2]=(...e)=>o.onCancel&&o.onCancel(...e))},"Cancel")):t.createCommentVNode("",!0),d]))])],32)};const p={inject:["ur_form"],props:{field:Object,form:Object,modelValue:null},emits:["update:modelValue"],computed:{error(){var e;return null==(e=this.ur_form.internal_errors)?void 0:e[this.field.__path.join(".")]},css(){return{root:[`form-group form-group__${this.field.name}`,{"-error":this.error}]}}},methods:{showLabel:e=>e.title&&"__root"!==e.name&&!["unrest-checkbox"].includes(e.ui.tagName)}},m={class:"input-wrapper"},f={key:1,class:"form-error"},h={key:2,class:"description"};p.render=function(e,r,o,n,l,a){return"unrest-hidden"!==o.field.ui.tagName?(t.openBlock(),t.createBlock("div",{key:0,class:a.css.root},[a.showLabel(o.field)?(t.openBlock(),t.createBlock("label",{key:0,for:o.field.id},t.toDisplayString(o.field.title),9,["for"])):t.createCommentVNode("",!0),t.createVNode("div",m,[(t.openBlock(),t.createBlock(t.resolveDynamicComponent(o.field.ui.tagName),{field:o.field,modelValue:o.modelValue,"onUpdate:modelValue":r[1]||(r[1]=t=>e.$emit("update:modelValue",t))},null,8,["field","modelValue"]))]),a.error?(t.openBlock(),t.createBlock("div",f,t.toDisplayString(a.error),1)):o.field.description?(t.openBlock(),t.createBlock("div",h,t.toDisplayString(o.field.description),1)):t.createCommentVNode("",!0)],2)):t.createCommentVNode("",!0)};const _={props:{modelValue:null,field:Object},emits:["update:modelValue"],computed:{mixed(){return"mixed"===this.modelValue},css(){const{mixed:e}=this,{disabled:t}=this.field;return[this.field.ui.css,"ur-checkbox -"+this.icon,{"-mixed":e,"-disabled":t}]},icon(){return this.mixed?"indeterminate":this.modelValue?"checked":"unchecked"}},methods:{onChange(){this.field.disabled||this.$emit("update:modelValue",!this.modelValue)}}};_.render=function(e,r,o,n,l,a){return t.openBlock(),t.createBlock("label",{class:a.css},[t.createVNode("input",{type:"checkbox",id:o.field.id,checked:o.modelValue,onInput:r[1]||(r[1]=(...e)=>a.onChange&&a.onChange(...e)),name:o.field.name},null,40,["id","checked","name"]),t.createTextVNode(" "+t.toDisplayString(o.field.title),1)],2)};const b={props:{modelValue:null,field:Object},emits:["update:modelValue"],data(){return{original:this.modelValue}},computed:{name(){var e,t,r;return(null==(e=this.modelValue)?void 0:e.name)||(null==(r=null==(t=this.modelValue)?void 0:t.split)?void 0:r.call(t,"/").pop())},css(){var e,t;return[null==(t=null==(e=this.field)?void 0:e.ui)?void 0:t.css,"ur-file"]},src(){var e;return(null==(e=this.modelValue)?void 0:e.dataURL)||this.modelValue},required:()=>!1},methods:{set(e){this.$emit("update:modelValue",e);const t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!0),this.$el.dispatchEvent(t)},onChange(e){const t=this.$refs.input.files[0];if(!t)return;const r=new FileReader;r.addEventListener("load",(()=>{const o={dataURL:r.result,name:t.name};this.$emit("update:modelValue",o),this.$refs.input.value="",this.$el.dispatchEvent(e)}),!1),r.readAsDataURL(t)}}},g={class:"name"},y=t.createVNode("div",{class:"btn -primary"}," Choose File ",-1);b.render=function(e,r,o,n,l,a){return t.openBlock(),t.createBlock("label",{for:o.field.id,class:a.css},[t.createVNode("input",{style:{display:"none"},type:"file",id:o.field.id,onChange:r[1]||(r[1]=t.withModifiers(((...e)=>a.onChange&&a.onChange(...e)),["stop"])),ref:"input"},null,40,["id"]),t.createVNode("div",null,[o.modelValue?(t.openBlock(),t.createBlock("img",{key:0,src:a.src},null,8,["src"])):t.createCommentVNode("",!0)]),t.createVNode("div",null,[t.createVNode("div",g,t.toDisplayString(a.name),1),l.original&&l.original!==o.modelValue?(t.openBlock(),t.createBlock("button",{key:0,class:"fa fa-undo",onClick:r[2]||(r[2]=t.withModifiers((e=>a.set(l.original)),["prevent"])),title:"Revert to original value"})):t.createCommentVNode("",!0),a.src&&!a.required?(t.openBlock(),t.createBlock("button",{key:1,class:"fa fa-trash",onClick:r[3]||(r[3]=t.withModifiers((e=>a.set(null)),["prevent"]))})):t.createCommentVNode("",!0),y])],10,["for"])};const v={inject:["ur_form"],props:{field:Object,modelValue:Object},computed:{children(){return Object.entries(this.field.properties).map((([e,t])=>i(e,t,this.ur_form,this.field.__path)))}}};v.render=function(e,r,o,n,l,a){const s=t.resolveComponent("unrest-field");return t.openBlock(!0),t.createBlock(t.Fragment,null,t.renderList(a.children,(e=>(t.openBlock(),t.createBlock(s,{key:e.id,field:e,modelValue:o.modelValue[e.name],"onUpdate:modelValue":t=>o.modelValue[e.name]=t},null,8,["field","modelValue","onUpdate:modelValue"])))),128)};var V="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},k=9007199254740991,j="[object Arguments]",O="[object Function]",w="[object GeneratorFunction]",C="[object Symbol]",B="object"==typeof V&&V&&V.Object===Object&&V,N="object"==typeof self&&self&&self.Object===Object&&self,P=B||N||Function("return this")();function S(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function x(e,t){for(var r=-1,o=t.length,n=e.length;++r<o;)e[n+r]=t[r];return e}var E=Object.prototype,A=E.hasOwnProperty,F=E.toString,I=P.Symbol,$=E.propertyIsEnumerable,D=I?I.isConcatSpreadable:void 0,L=Math.max;function U(e,t,r,o,n){var l=-1,a=e.length;for(r||(r=R),n||(n=[]);++l<a;){var s=e[l];t>0&&r(s)?t>1?U(s,t-1,r,o,n):x(n,s):o||(n[n.length]=s)}return n}function R(e){return q(e)||function(e){return function(e){return M(e)&&function(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=k}(e.length)&&!function(e){var t=function(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}(e)?F.call(e):"";return t==O||t==w}(e)}(e)}(e)&&A.call(e,"callee")&&(!$.call(e,"callee")||F.call(e)==j)}(e)||!!(D&&e&&e[D])}function T(e){if("string"==typeof e||function(e){return"symbol"==typeof e||M(e)&&F.call(e)==C}(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}var q=Array.isArray;function M(e){return!!e&&"object"==typeof e}var z,G,H=(z=function(e,t){return null==e?{}:function(e,t){return function(e,t,r){for(var o=-1,n=t.length,l={};++o<n;){var a=t[o],s=e[a];r(s,a)&&(l[a]=s)}return l}(e=Object(e),t,(function(t,r){return r in e}))}(e,function(e,t){for(var r=-1,o=e?e.length:0,n=Array(o);++r<o;)n[r]=t(e[r],r,e);return n}(U(t,1),T))},G=L(void 0===G?z.length-1:G,0),function(){for(var e=arguments,t=-1,r=L(e.length-G,0),o=Array(r);++t<r;)o[t]=e[G+t];t=-1;for(var n=Array(G+1);++t<G;)n[t]=e[t];return n[G]=o,S(z,this,n)});const Z={props:{modelValue:null,field:Object},emits:["update:modelValue"],data:()=>({showError:!1}),computed:{inputAttrs(){const e=H(this.field,["name","disabled","placeholder","id"]);return e.value=this.modelValue,e.type=this.field.ui.type,e.class="form-control",e}},methods:{onChange(e){const t=((e,t={})=>"number"===t.type?""===e?NaN:Number(e):e)(e.target.value,this.field);"number"===this.field.type&&isNaN(t)||this.$emit("update:modelValue",t)}}};Z.render=function(e,r,o,n,l,a){return t.openBlock(),t.createBlock("input",t.mergeProps(a.inputAttrs,{onInput:r[1]||(r[1]=(...e)=>a.onChange&&a.onChange(...e)),class:"form-control"}),null,16)};const J={mixins:[Z],data:()=>({show_password:!1}),computed:{iconClass(){return"input-group-append cursor-pointer fa fa-eye"+(this.show_password?"-slash":"")},type(){return this.show_password?"text":"password"}}},K={class:"input-group"};J.render=function(e,r,o,n,l,a){return t.openBlock(),t.createBlock("div",K,[t.createVNode("input",t.mergeProps(e.inputAttrs,{onInput:r[1]||(r[1]=(...t)=>e.onChange&&e.onChange(...t)),class:"form-control",type:a.type}),null,16,["type"]),t.createVNode("i",{class:a.iconClass,onClick:r[2]||(r[2]=e=>l.show_password=!l.show_password)},null,2)])};const Q={props:{field:Object,modelValue:Number},emits:["update:modelValue"],computed:{inputAttrs(){return H(this.field.ui,["min","max","step"])}},methods:{change(e){this.$emit("update:modelValue",Number(e.target.value))}}},W={class:"ur-range"},X={class:"ur-range__value"};Q.render=function(e,r,o,n,l,a){return t.openBlock(),t.createBlock("div",W,[t.createVNode("input",t.mergeProps({type:"range"},a.inputAttrs,{onInput:r[1]||(r[1]=(...e)=>a.change&&a.change(...e)),onChange:r[2]||(r[2]=(...e)=>a.change&&a.change(...e)),value:o.modelValue}),null,16,["value"]),t.createVNode("div",X,t.toDisplayString(o.modelValue),1)])};const Y={props:{modelValue:null,field:Object,form:Object},emits:["update:modelValue"],computed:{choices(){if(this.field.getChoices)return this.field.getChoices();const e=this.field.enumNames||this.field.enum;return this.field.enum.map(((t,r)=>({value:t,name:e[r]})))}},methods:{onChange(e){this.$emit("update:modelValue",e.target.value)}}};Y.render=function(e,r,o,n,l,a){return t.openBlock(),t.createBlock("select",{onInput:r[1]||(r[1]=(...e)=>a.onChange&&a.onChange(...e)),value:o.modelValue,id:o.field.id,class:"form-control"},[(t.openBlock(!0),t.createBlock(t.Fragment,null,t.renderList(a.choices,(e=>(t.openBlock(),t.createBlock("option",{value:e.value,key:e.name},t.toDisplayString(e.name),9,["value"])))),128))],40,["value","id"])};const ee={Form:c,Field:p,Checkbox:_,Image:b,Object:v,Range:Q,Select:Y,Text:Z,Password:J},te={install:e=>{Object.entries(ee).forEach((([t,r])=>e.component("Unrest"+t,r)))}};return __spreadProps(__spreadValues({prepField:i,parseLazySchema:a,plugin:te},ee),{install:e=>{console.warn("DEPRACATED: Use UrForm.plugin"),e.use(te)}})}));
