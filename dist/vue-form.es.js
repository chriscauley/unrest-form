var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,i=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,a=(e,t)=>{for(var r in t||(t={}))o.call(t,r)&&i(e,r,t[r]);if(n)for(var r of n(t))l.call(t,r)&&i(e,r,t[r]);return e};import{reactive as s,resolveComponent as u,openBlock as c,createBlock as d,withModifiers as p,createVNode as m,Fragment as h,renderList as f,toDisplayString as b,renderSlot as y,createCommentVNode as v,resolveDynamicComponent as g,createTextVNode as _,mergeProps as j}from"vue";import{validate as V}from"jsonschema";const O=e=>{const t={};return Object.entries(e).forEach((([e,r])=>{if(null==r||""===r)return;if(r.constructor!==Object)return void(t[e]=r);const n=O(r);Object.keys(n).length>0&&(t[e]=n)})),t};const C=(e,t)=>{if("object"===t.type)return e=e||{},Object.entries(t.properties).forEach((([t,r])=>{e[t]=C(e[t],r)})),e;const r=e||t.default;return["integer","number"].includes(t.type)?isNaN(Number(r))?r:Number(r):r};var w=e=>(e=e.replace(/([A-Z])/g," $1").toLowerCase().replace(/_/g," "))[0].toUpperCase()+e.slice(1);const k=["number","string","boolean"],E=e=>{if(null==e)return{};for(let t=0;t<k.length;t++)if(typeof e===k[t])return{default:e,type:k[t]};if(Array.isArray(e))return{type:"array",default:e,items:E(e[0])};if("lazy"===e.type){const t={};return Object.entries(e).forEach((([e,r])=>t[e]=E(r))),delete t.type,{type:"object",properties:t}}if(e.type)return e;throw"Unrecognized schema object for parseLazySchema"},A=e=>"object"===e.type?"unrest-object":e.enum?"unrest-select":"boolean"===e.type?"unrest-checkbox":"image"===e.type?"unrest-image":"color"===e.format?"unrest-color":"password"===e.format?"unrest-password":"HiddenInput"===e.__widget?"unrest-hidden":"unrest-text";var x=(e,t,{ui:r={}}={},i=[])=>{var a=((e,t)=>{var r={};for(var i in e)o.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&n)for(var i of n(e))t.indexOf(i)<0&&l.call(e,i)&&(r[i]=e[i]);return r})(t,[]);return"lazy"===a.type&&(a=E(a)),a.name=e,a.id=`id__${a.name}`,a.ui=((e,t)=>{const r={type:"text",tagName:A(e)};return"number"===e.type&&(r.type="number"),"password"===e.format&&(r.type="password"),Object.assign(r,t[e.name],e.ui)})(a,r),void 0===a.title&&(a.title=w(a.name)),a.__path=i.slice(),"__root"!==e&&a.__path.push(a.name),a};const $={provide(){return{ur_form:this}},props:{schema:Object,uiSchema:Object,state:{type:Object,default:()=>s({})},onError:Function,onSubmit:Function,onChange:Function,onInput:Function,errors:Object,focus:{type:Boolean,default:()=>!0},onCancel:Function},emits:["error"],data:()=>({internal_errors:null}),computed:{computed_errors(){const e=a(a({},this.errors),this.internal_errors);return e.__all__&&(e.__root=e.__all__),e.__root&&!Array.isArray(e.__root)&&(e.__root=[e.__root]),e},prepped_schema(){return x("__root",this.schema)}},beforeMount(){C(this.state,this.prepped_schema)},mounted(){var e;this.focus&&(null==(e=this.$el.querySelector("input"))||e.focus())},methods:{setErrors(e){this.internal_errors=e,e&&this.$emit("error",e)},handleError(e){var t,r,n,o;throw e.message&&this.setErrors({__root:e.message||e}),(null==(r=null==(t=e.response)?void 0:t.data)?void 0:r.errors)&&this.setErrors(null==(o=null==(n=e.response)?void 0:n.data)?void 0:o.errors),e},change(e){var t;null==(t=this.onChange)||t.call(this,this.state,e)},input(e){var t;null==(t=this.onInput)||t.call(this,this.state,e)},submit(e){var t;if(this.setErrors(((e,t)=>{const r=V(O(e),t);if(!r.errors.length)return null;const n={};return r.errors.forEach((({path:e,argument:t,message:r,name:o})=>{e=[...e,t],n[e.join(".")]="required"===o?"This field is required.":r})),n})(this.state,this.prepped_schema)),!this.internal_errors)try{null==(t=this.onSubmit(this.state,e))||t.catch(this.handleError)}catch(r){this.handleError(r)}}}},N={class:"ur-form__actions"},F=m("button",{type:"submit",class:"btn -primary"},"Submit",-1);$.render=function(e,t,r,n,o,l){var i;const a=u("unrest-field");return c(),d("form",{onSubmit:t[3]||(t[3]=p(((...e)=>l.submit&&l.submit(...e)),["prevent"])),class:"ur-form"},[m(a,{modelValue:r.state,"onUpdate:modelValue":t[1]||(t[1]=e=>r.state=e),field:l.prepped_schema,key:l.prepped_schema.id,onChange:l.change,onInput:l.input},null,8,["modelValue","field","onChange","onInput"]),(c(!0),d(h,null,f(null==(i=l.computed_errors)?void 0:i.__root,((e,t)=>(c(),d("div",{key:t,class:"form-error"},b(e.message),1)))),128)),m("div",N,[y(e.$slots,"actions",{},(()=>[r.onCancel?(c(),d("div",{key:0,type:"cancel",class:"btn -secondary",onClick:t[2]||(t[2]=(...e)=>r.onCancel&&r.onCancel(...e))},"Cancel")):v("",!0),F]))])],32)};const I={inject:["ur_form"],props:{field:Object,form:Object,modelValue:null},emits:["update:modelValue"],computed:{error(){var e;let t=null==(e=this.ur_form.internal_errors)?void 0:e[this.field.__path.join(".")];return Array.isArray(t)&&(t=t[0]),(null==t?void 0:t.message)&&(t=t.message),t},css(){return{root:[`form-group form-group__${this.field.name}`,{"-error":this.error}]}}},methods:{showLabel:e=>e.title&&"__root"!==e.name&&!["unrest-checkbox"].includes(e.ui.tagName)}},S={class:"input-wrapper"},U={key:1,class:"form-error"},L={key:2,class:"description"};I.render=function(e,t,r,n,o,l){return"unrest-hidden"!==r.field.ui.tagName?(c(),d("div",{key:0,class:l.css.root},[l.showLabel(r.field)?(c(),d("label",{key:0,for:r.field.id},b(r.field.title),9,["for"])):v("",!0),m("div",S,[(c(),d(g(r.field.ui.tagName),{field:r.field,modelValue:r.modelValue,"onUpdate:modelValue":t[1]||(t[1]=t=>e.$emit("update:modelValue",t))},null,8,["field","modelValue"]))]),l.error?(c(),d("div",U,b(l.error),1)):r.field.description?(c(),d("div",L,b(r.field.description),1)):v("",!0)],2)):v("",!0)};const P={props:{modelValue:null,field:Object},emits:["update:modelValue"],computed:{mixed(){return"mixed"===this.modelValue},css(){const{mixed:e}=this,{disabled:t}=this.field;return[this.field.ui.css,"ur-checkbox -"+this.icon,{"-mixed":e,"-disabled":t}]},icon(){return this.mixed?"indeterminate":this.modelValue?"checked":"unchecked"}},methods:{onChange(){this.field.disabled||this.$emit("update:modelValue",!this.modelValue)}}};P.render=function(e,t,r,n,o,l){return c(),d("label",{class:l.css},[m("input",{type:"checkbox",id:r.field.id,checked:r.modelValue,onInput:t[1]||(t[1]=(...e)=>l.onChange&&l.onChange(...e)),name:r.field.name},null,40,["id","checked","name"]),_(" "+b(r.field.title),1)],2)};const R={props:{modelValue:null,field:Object},emits:["update:modelValue"],data(){return{original:this.modelValue}},computed:{name(){var e,t,r;return(null==(e=this.modelValue)?void 0:e.name)||(null==(r=null==(t=this.modelValue)?void 0:t.split)?void 0:r.call(t,"/").pop())},css(){var e,t;return[null==(t=null==(e=this.field)?void 0:e.ui)?void 0:t.css,"ur-file"]},src(){var e;return(null==(e=this.modelValue)?void 0:e.dataURL)||this.modelValue},required:()=>!1},methods:{set(e){this.$emit("update:modelValue",e);const t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!0),this.$el.dispatchEvent(t)},onChange(e){const t=this.$refs.input.files[0];if(!t)return;const r=new FileReader;r.addEventListener("load",(()=>{const n={dataURL:r.result,name:t.name};this.$emit("update:modelValue",n),this.$refs.input.value="",this.$el.dispatchEvent(e)}),!1),r.readAsDataURL(t)}}},T={class:"name"},q=m("div",{class:"btn -primary"}," Choose File ",-1);R.render=function(e,t,r,n,o,l){return c(),d("label",{for:r.field.id,class:l.css},[m("input",{style:{display:"none"},type:"file",id:r.field.id,onChange:t[1]||(t[1]=p(((...e)=>l.onChange&&l.onChange(...e)),["stop"])),ref:"input"},null,40,["id"]),m("div",null,[r.modelValue?(c(),d("img",{key:0,src:l.src},null,8,["src"])):v("",!0)]),m("div",null,[m("div",T,b(l.name),1),o.original&&o.original!==r.modelValue?(c(),d("div",{key:0,class:"fa fa-undo cursor-pointer",onClick:t[2]||(t[2]=p((e=>l.set(o.original)),["prevent"])),title:"Revert to original value",role:"button"})):v("",!0),l.src&&!l.required?(c(),d("div",{key:1,class:"fa fa-trash",onClick:t[3]||(t[3]=e=>l.set(null))})):v("",!0),q])],10,["for"])};const z={inject:["ur_form"],props:{field:Object,modelValue:Object},computed:{children(){return Object.entries(this.field.properties).map((([e,t])=>x(e,t,this.ur_form,this.field.__path)))}}};z.render=function(e,t,r,n,o,l){const i=u("unrest-field");return c(!0),d(h,null,f(l.children,(e=>(c(),d(i,{key:e.id,field:e,modelValue:r.modelValue[e.name],"onUpdate:modelValue":t=>r.modelValue[e.name]=t},null,8,["field","modelValue","onUpdate:modelValue"])))),128)};var D="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},M="[object GeneratorFunction]",H="object"==typeof D&&D&&D.Object===Object&&D,B="object"==typeof self&&self&&self.Object===Object&&self,G=H||B||Function("return this")();function Z(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function J(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}var K=Object.prototype,Q=K.hasOwnProperty,W=K.toString,X=G.Symbol,Y=K.propertyIsEnumerable,ee=X?X.isConcatSpreadable:void 0,te=Math.max;function re(e,t,r,n,o){var l=-1,i=e.length;for(r||(r=ne),o||(o=[]);++l<i;){var a=e[l];t>0&&r(a)?t>1?re(a,t-1,r,n,o):J(o,a):n||(o[o.length]=a)}return o}function ne(e){return le(e)||function(e){return function(e){return ie(e)&&function(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!function(e){var t=function(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}(e)?W.call(e):"";return"[object Function]"==t||t==M}(e)}(e)}(e)&&Q.call(e,"callee")&&(!Y.call(e,"callee")||"[object Arguments]"==W.call(e))}(e)||!!(ee&&e&&e[ee])}function oe(e){if("string"==typeof e||function(e){return"symbol"==typeof e||ie(e)&&"[object Symbol]"==W.call(e)}(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}var le=Array.isArray;function ie(e){return!!e&&"object"==typeof e}var ae,se,ue=(ae=function(e,t){return null==e?{}:function(e,t){return function(e,t,r){for(var n=-1,o=t.length,l={};++n<o;){var i=t[n],a=e[i];r(a,i)&&(l[i]=a)}return l}(e=Object(e),t,(function(t,r){return r in e}))}(e,function(e,t){for(var r=-1,n=e?e.length:0,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o}(re(t,1),oe))},se=te(void 0===se?ae.length-1:se,0),function(){for(var e=arguments,t=-1,r=te(e.length-se,0),n=Array(r);++t<r;)n[t]=e[se+t];t=-1;for(var o=Array(se+1);++t<se;)o[t]=e[t];return o[se]=n,Z(ae,this,o)});const ce={props:{modelValue:null,field:Object},emits:["update:modelValue"],data:()=>({showError:!1}),computed:{inputAttrs(){const e=ue(this.field,["name","disabled","placeholder","id"]);return e.value=this.modelValue,e.type=this.field.ui.type,e.class="form-control",e}},methods:{onChange(e){const t=((e,t={})=>"number"===t.type?""===e?NaN:Number(e):e)(e.target.value,this.field);"number"===this.field.type&&isNaN(t)||this.$emit("update:modelValue",t)}}};ce.render=function(e,t,r,n,o,l){return c(),d("input",j(l.inputAttrs,{onInput:t[1]||(t[1]=(...e)=>l.onChange&&l.onChange(...e)),class:"form-control"}),null,16)};const de={mixins:[ce],data:()=>({show_password:!1}),computed:{iconClass(){return"input-group-append cursor-pointer fa fa-eye"+(this.show_password?"-slash":"")},type(){return this.show_password?"text":"password"}}},pe={class:"input-group"};de.render=function(e,t,r,n,o,l){return c(),d("div",pe,[m("input",j(e.inputAttrs,{onInput:t[1]||(t[1]=(...t)=>e.onChange&&e.onChange(...t)),class:"form-control",type:l.type}),null,16,["type"]),m("i",{class:l.iconClass,onClick:t[2]||(t[2]=e=>o.show_password=!o.show_password)},null,2)])};const me={props:{field:Object,modelValue:Number},emits:["update:modelValue"],computed:{inputAttrs(){return ue(this.field.ui,["min","max","step"])}},methods:{change(e){this.$emit("update:modelValue",Number(e.target.value))}}},he={class:"ur-range"},fe={class:"ur-range__value"};me.render=function(e,t,r,n,o,l){return c(),d("div",he,[m("input",j({type:"range"},l.inputAttrs,{onInput:t[1]||(t[1]=(...e)=>l.change&&l.change(...e)),onChange:t[2]||(t[2]=(...e)=>l.change&&l.change(...e)),value:r.modelValue}),null,16,["value"]),m("div",fe,b(r.modelValue),1)])};const be={props:{modelValue:null,field:Object,form:Object},emits:["update:modelValue"],computed:{choices(){if(this.field.getChoices)return this.field.getChoices();const e=this.field.enumNames||this.field.enum;return this.field.enum.map(((t,r)=>({value:t,name:e[r]})))}},methods:{onChange(e){this.$emit("update:modelValue",e.target.value)}}};be.render=function(e,t,r,n,o,l){return c(),d("select",{onInput:t[1]||(t[1]=(...e)=>l.onChange&&l.onChange(...e)),value:r.modelValue,id:r.field.id,class:"form-control"},[(c(!0),d(h,null,f(l.choices,(e=>(c(),d("option",{value:e.value,key:e.name},b(e.name),9,["value"])))),128))],40,["value","id"])};const ye={Form:$,Field:I,Checkbox:P,Image:R,Object:z,Range:me,Select:be,Text:ce,Password:de},ve={install:e=>{Object.entries(ye).forEach((([t,r])=>e.component("Unrest"+t,r)))}};var ge,_e=(ge=a({prepField:x,parseLazySchema:E,plugin:ve},ye),t(ge,r({install:e=>{console.warn("DEPRACATED: Use UrForm.plugin"),e.use(ve)}})));export default _e;
