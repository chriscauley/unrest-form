var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,o=Object.prototype.hasOwnProperty,l=Object.prototype.propertyIsEnumerable,a=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,i=(e,t)=>{for(var r in t||(t={}))o.call(t,r)&&a(e,r,t[r]);if(n)for(var r of n(t))l.call(t,r)&&a(e,r,t[r]);return e};import{reactive as s,resolveComponent as u,openBlock as c,createBlock as d,withModifiers as p,createVNode as m,Fragment as h,renderList as f,toDisplayString as v,renderSlot as b,createCommentVNode as g,resolveDynamicComponent as y,createTextVNode as _,withDirectives as V,mergeProps as j,vModelText as C,vModelDynamic as O}from"vue";import{validate as k}from"jsonschema";const w=e=>{const t={};return Object.entries(e).forEach((([e,r])=>{if(null==r||""===r)return;if(r.constructor!==Object)return void(t[e]=r);const n=w(r);Object.keys(n).length>0&&(t[e]=n)})),t};const x=(e,t)=>{if("object"===t.type)return e=e||{},Object.entries(t.properties).forEach((([t,r])=>{e[t]=x(e[t],r)})),e;const r=e||t.default;return["integer","number"].includes(t.type)?isNaN(Number(r))?r:Number(r):r};var E=e=>(e=e.replace(/([A-Z])/g," $1").toLowerCase().replace(/_/g," "))[0].toUpperCase()+e.slice(1);const A=["number","string","boolean"],$=e=>{if(null==e)return{};for(let t=0;t<A.length;t++)if(typeof e===A[t])return{default:e,type:A[t]};if(Array.isArray(e))return{type:"array",default:e,items:$(e[0])};if("lazy"===e.type){const t={};return Object.entries(e).forEach((([e,r])=>t[e]=$(r))),delete t.type,{type:"object",properties:t}}if(e.type)return e;throw"Unrecognized schema object for parseLazySchema"},I=e=>"object"===e.type?"unrest-object":e.enum||e.getChoices?"unrest-select":"boolean"===e.type?"unrest-checkbox":"image"===e.type?"unrest-image":"color"===e.format?"unrest-color":"password"===e.format?"unrest-password":"HiddenInput"===e.__widget?"unrest-hidden":"unrest-text";var N=(e,t,{ui:r={}}={},a=[])=>{var i=((e,t)=>{var r={};for(var a in e)o.call(e,a)&&t.indexOf(a)<0&&(r[a]=e[a]);if(null!=e&&n)for(var a of n(e))t.indexOf(a)<0&&l.call(e,a)&&(r[a]=e[a]);return r})(t,[]);return"lazy"===i.type&&(i=$(i)),i.name=e,i.id=`id__${i.name}`,i.ui=((e,t)=>{const r={type:"text",tagName:I(e)};return"number"===e.type&&(r.type="number"),"password"===e.format&&(r.type="password"),"email"===e.format&&(r.type="email"),Object.assign(r,t[e.name],e.ui)})(i,r),void 0===i.title&&(i.title=E(i.name)),i.__path=a.slice(),"__root"!==e&&i.__path.push(i.name),i};const F={provide(){return{ur_form:this}},props:{schema:Object,ui:Object,state:{type:Object,default:()=>s({})},onError:Function,onSubmit:Function,onChange:Function,onInput:Function,errors:Object,focus:{type:Boolean,default:()=>!0},onCancel:Function},emits:["error"],data:()=>({internal_errors:null,loading:!1}),computed:{computed_errors(){const e=i(i({},this.errors),this.internal_errors);return e.__all__&&(e.__root=e.__all__),e.__root&&!Array.isArray(e.__root)&&(e.__root=[e.__root]),e},prepped_schema(){return N("__root",this.schema)}},beforeMount(){x(this.state,this.prepped_schema)},mounted(){var e;this.focus&&(null==(e=this.$el.querySelector("input"))||e.focus())},methods:{setErrors(e){this.internal_errors=e,e&&this.$emit("error",e)},handleError(e){var t,r,n,o;throw this.loading=!1,e.message&&this.setErrors({__root:e.message||e}),(null==(r=null==(t=e.response)?void 0:t.data)?void 0:r.errors)&&this.setErrors(null==(o=null==(n=e.response)?void 0:n.data)?void 0:o.errors),e},change(e){var t;null==(t=this.onChange)||t.call(this,this.state,e)},input(e){var t;null==(t=this.onInput)||t.call(this,this.state,e)},submit(e){var t;if(!this.loading){if(this.setErrors(((e,t)=>{const r=k(w(e),t);if(!r.errors.length)return null;const n={};return r.errors.forEach((({path:e,argument:t,message:r,name:o})=>{e=[...e,t],n[e.join(".")]="required"===o?"This field is required.":r})),n})(this.state,this.prepped_schema)),this.internal_errors)return console.error(this.state),void console.error(this.internal_errors);try{this.loading=!0,Promise.resolve(null==(t=this.onSubmit)?void 0:t.call(this,this.state,e)).then((e=>(this.loading=!1,e))).catch(this.handleError)}catch(r){this.handleError(r)}}}}},U={class:"ur-form__actions"},S=m("button",{type:"submit",class:"btn -primary"},"Submit",-1);F.render=function(e,t,r,n,o,l){var a;const i=u("unrest-field");return c(),d("form",{onSubmit:t[3]||(t[3]=p(((...e)=>l.submit&&l.submit(...e)),["prevent"])),class:["ur-form",e.loading&&"-loading"]},[m(i,{modelValue:r.state,"onUpdate:modelValue":t[1]||(t[1]=e=>r.state=e),field:l.prepped_schema,key:l.prepped_schema.id,onChange:l.change,onInput:l.input},null,8,["modelValue","field","onChange","onInput"]),(c(!0),d(h,null,f(null==(a=l.computed_errors)?void 0:a.__root,((e,t)=>(c(),d("div",{key:t,class:"form-error"},v(e.message||e),1)))),128)),m("div",U,[b(e.$slots,"actions",{},(()=>[r.onCancel?(c(),d("div",{key:0,type:"cancel",class:"btn -secondary",onClick:t[2]||(t[2]=(...e)=>r.onCancel&&r.onCancel(...e))},"Cancel")):g("",!0),S,b(e.$slots,"extra_actions")]))])],34)};const L={inject:["ur_form"],props:{field:Object,form:Object,modelValue:null},emits:["update:modelValue"],computed:{error(){var e;let t=null==(e=this.ur_form.internal_errors)?void 0:e[this.field.__path.join(".")];return Array.isArray(t)&&(t=t[0]),(null==t?void 0:t.message)&&(t=t.message),t},css(){return{root:[`form-group form-group__${this.field.name}`,{"-error":this.error}]}}},methods:{showLabel:e=>e.title&&"__root"!==e.name&&!["unrest-checkbox"].includes(e.ui.tagName)}},P={class:"input-wrapper"},R={key:1,class:"form-error"},T={key:2,class:"description"};L.render=function(e,t,r,n,o,l){return"unrest-hidden"!==r.field.ui.tagName?(c(),d("div",{key:0,class:l.css.root},[l.showLabel(r.field)?(c(),d("label",{key:0,for:r.field.id},v(r.field.title),9,["for"])):g("",!0),m("div",P,[(c(),d(y(r.field.ui.tagName),{field:r.field,modelValue:r.modelValue,"onUpdate:modelValue":t[1]||(t[1]=t=>e.$emit("update:modelValue",t))},null,8,["field","modelValue"]))]),l.error?(c(),d("div",R,v(l.error),1)):r.field.description?(c(),d("div",T,v(r.field.description),1)):g("",!0)],2)):g("",!0)};const q={props:{modelValue:null,field:Object},emits:["update:modelValue"],computed:{mixed(){return"mixed"===this.modelValue},css(){const{mixed:e}=this,{disabled:t}=this.field;return[this.field.ui.css,"ur-checkbox -"+this.icon,{"-mixed":e,"-disabled":t}]},icon(){return this.mixed?"indeterminate":this.modelValue?"checked":"unchecked"}},methods:{onChange(){this.field.disabled||this.$emit("update:modelValue",!this.modelValue)}}};q.render=function(e,t,r,n,o,l){return c(),d("label",{class:l.css},[m("input",{type:"checkbox",id:r.field.id,checked:r.modelValue,onInput:t[1]||(t[1]=(...e)=>l.onChange&&l.onChange(...e)),name:r.field.name},null,40,["id","checked","name"]),_(" "+v(r.field.title),1)],2)};var z=e=>{let t;if(e.getChoices)t=e.getChoices();else{const r=e.enumNames||e.enum;t=e.enum.map(((e,t)=>({value:e,name:r[t]})))}return e.placeholder&&t.unshift({name:e.placeholder,value:""}),t};const D={props:{modelValue:null,field:Object},emits:["update:modelValue"],computed:{choices(){const e=z(this.field),{disabled:t}=this.field;return e.forEach((e=>{var r;e.checked=null==(r=this.modelValue)?void 0:r.includes(e.value),e.class=["ur-checkbox",e.checked?"-checked":"-unchecked",t&&"-disabled"]})),e}},methods:{change(){this.field.disabled||this.$emit("update:modelValue",this.choices.filter((e=>e.checked)))}}};D.render=function(e,t,r,n,o,l){return c(),d("div",null,[(c(!0),d(h,null,f(l.choices,((t,n)=>(c(),d("label",{class:t.class,key:n},[m("input",{type:"checkbox",checked:e.isChecked[t.value],onInput:()=>l.change(t.value),name:t.name},null,40,["checked","onInput","name"]),_(" "+v(r.field.title),1)],2)))),128))])};const M={props:{modelValue:null,field:Object},emits:["update:modelValue"],data(){return{original:this.modelValue}},computed:{name(){var e,t,r;return(null==(e=this.modelValue)?void 0:e.name)||(null==(r=null==(t=this.modelValue)?void 0:t.split)?void 0:r.call(t,"/").pop())},css(){var e,t;return[null==(t=null==(e=this.field)?void 0:e.ui)?void 0:t.css,"ur-file"]},src(){var e;return(null==(e=this.modelValue)?void 0:e.dataURL)||this.modelValue},required:()=>!1},methods:{set(e){this.$emit("update:modelValue",e);const t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!0),this.$el.dispatchEvent(t)},onChange(e){const t=this.$refs.input.files[0];if(!t)return;const r=new FileReader;r.addEventListener("load",(()=>{const n={dataURL:r.result,name:t.name};this.$emit("update:modelValue",n),this.$refs.input.value="",this.$el.dispatchEvent(e)}),!1),r.readAsDataURL(t)}}},B={class:"name"},H=m("div",{class:"btn -primary"}," Choose File ",-1);M.render=function(e,t,r,n,o,l){return c(),d("label",{for:r.field.id,class:l.css},[m("input",{style:{display:"none"},type:"file",id:r.field.id,onChange:t[1]||(t[1]=p(((...e)=>l.onChange&&l.onChange(...e)),["stop"])),ref:"input"},null,40,["id"]),m("div",null,[r.modelValue?(c(),d("img",{key:0,src:l.src},null,8,["src"])):g("",!0)]),m("div",null,[m("div",B,v(l.name),1),o.original&&o.original!==r.modelValue?(c(),d("div",{key:0,class:"fa fa-undo cursor-pointer",onClick:t[2]||(t[2]=p((e=>l.set(o.original)),["prevent"])),title:"Revert to original value",role:"button"})):g("",!0),l.src&&!l.required?(c(),d("div",{key:1,class:"fa fa-trash",onClick:t[3]||(t[3]=e=>l.set(null))})):g("",!0),H])],10,["for"])};const G={inject:["ur_form"],props:{field:Object,modelValue:Object},computed:{children(){return Object.entries(this.field.properties).map((([e,t])=>N(e,t,this.ur_form,this.field.__path)))}}};G.render=function(e,t,r,n,o,l){const a=u("unrest-field");return c(!0),d(h,null,f(l.children,(e=>(c(),d(a,{key:e.id,field:e,modelValue:r.modelValue[e.name],"onUpdate:modelValue":t=>r.modelValue[e.name]=t},null,8,["field","modelValue","onUpdate:modelValue"])))),128)};var Z="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},J="[object GeneratorFunction]",K="object"==typeof Z&&Z&&Z.Object===Object&&Z,Q="object"==typeof self&&self&&self.Object===Object&&self,W=K||Q||Function("return this")();function X(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function Y(e,t){for(var r=-1,n=t.length,o=e.length;++r<n;)e[o+r]=t[r];return e}var ee=Object.prototype,te=ee.hasOwnProperty,re=ee.toString,ne=W.Symbol,oe=ee.propertyIsEnumerable,le=ne?ne.isConcatSpreadable:void 0,ae=Math.max;function ie(e,t,r,n,o){var l=-1,a=e.length;for(r||(r=se),o||(o=[]);++l<a;){var i=e[l];t>0&&r(i)?t>1?ie(i,t-1,r,n,o):Y(o,i):n||(o[o.length]=i)}return o}function se(e){return ce(e)||function(e){return function(e){return de(e)&&function(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!function(e){var t=function(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}(e)?re.call(e):"";return"[object Function]"==t||t==J}(e)}(e)}(e)&&te.call(e,"callee")&&(!oe.call(e,"callee")||"[object Arguments]"==re.call(e))}(e)||!!(le&&e&&e[le])}function ue(e){if("string"==typeof e||function(e){return"symbol"==typeof e||de(e)&&"[object Symbol]"==re.call(e)}(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}var ce=Array.isArray;function de(e){return!!e&&"object"==typeof e}var pe,me,he=(pe=function(e,t){return null==e?{}:function(e,t){return function(e,t,r){for(var n=-1,o=t.length,l={};++n<o;){var a=t[n],i=e[a];r(i,a)&&(l[a]=i)}return l}(e=Object(e),t,(function(t,r){return r in e}))}(e,function(e,t){for(var r=-1,n=e?e.length:0,o=Array(n);++r<n;)o[r]=t(e[r],r,e);return o}(ie(t,1),ue))},me=ae(void 0===me?pe.length-1:me,0),function(){for(var e=arguments,t=-1,r=ae(e.length-me,0),n=Array(r);++t<r;)n[t]=e[me+t];t=-1;for(var o=Array(me+1);++t<me;)o[t]=e[t];return o[me]=n,X(pe,this,o)}),fe=(e,t={})=>"number"===t.type||"integer"===t.type?""===e?NaN:Number(e):"array"===t.type&&"string"==typeof e?e.split(t.delimiter||",").map((e=>e.trim())).filter(Boolean):e;const ve={props:{modelValue:null,field:Object},emits:["update:modelValue"],data(){return{showError:!1,value:this.modelValue}},computed:{inputAttrs(){const e=he(this.field,["name","disabled","placeholder","id","readOnly"]);return e.type=this.field.ui.type,e.class="form-control",e},textarea(){return"Textarea"===this.field.__widget}},watch:{modelValue(){this.value=this.modelValue}},methods:{onChange(){const e=fe(this.value,this.field);"number"===this.field.type&&isNaN(e)||this.$emit("update:modelValue",e)}}};ve.render=function(e,t,r,n,o,l){return l.textarea?V((c(),d("textarea",j({key:0},l.inputAttrs,{"onUpdate:modelValue":t[1]||(t[1]=e=>o.value=e),onInput:t[2]||(t[2]=(...e)=>l.onChange&&l.onChange(...e))}),null,16)),[[C,o.value]]):V((c(),d("input",j({key:1},l.inputAttrs,{"onUpdate:modelValue":t[3]||(t[3]=e=>o.value=e),onInput:t[4]||(t[4]=(...e)=>l.onChange&&l.onChange(...e))}),null,16)),[[O,o.value]])};const be={mixins:[ve],data:()=>({show_password:!1}),computed:{iconClass(){return"input-group-append cursor-pointer fa fa-eye"+(this.show_password?"-slash":"")},type(){return this.show_password?"text":"password"}}},ge={class:"input-group"};be.render=function(e,t,r,n,o,l){return c(),d("div",ge,[V(m("input",j(e.inputAttrs,{onInput:t[1]||(t[1]=(...t)=>e.onChange&&e.onChange(...t)),"onUpdate:modelValue":t[2]||(t[2]=t=>e.value=t),class:"form-control",type:l.type}),null,16,["type"]),[[O,e.value]]),m("i",{class:l.iconClass,onClick:t[3]||(t[3]=e=>o.show_password=!o.show_password)},null,2)])};const ye={props:{field:Object,modelValue:Number},emits:["update:modelValue"],computed:{inputAttrs(){return he(this.field.ui,["min","max","step"])}},methods:{change(e){this.$emit("update:modelValue",Number(e.target.value))}}},_e={class:"ur-range"},Ve={class:"ur-range__value"};ye.render=function(e,t,r,n,o,l){return c(),d("div",_e,[m("input",j({type:"range"},l.inputAttrs,{onInput:t[1]||(t[1]=(...e)=>l.change&&l.change(...e)),onChange:t[2]||(t[2]=(...e)=>l.change&&l.change(...e)),value:r.modelValue}),null,16,["value"]),m("div",Ve,v(r.modelValue),1)])};const je={props:{modelValue:null,field:Object,form:Object},emits:["update:modelValue"],computed:{choices(){return z(this.field)}},methods:{onChange(e){const t=fe(e.target.value,this.field);this.$emit("update:modelValue",t)}}};je.render=function(e,t,r,n,o,l){return c(),d("select",{onInput:t[1]||(t[1]=(...e)=>l.onChange&&l.onChange(...e)),value:r.modelValue,id:r.field.id,class:"form-control"},[(c(!0),d(h,null,f(l.choices,(e=>(c(),d("option",{value:e.value,key:e.name},v(e.name),9,["value"])))),128))],40,["value","id"])};const Ce={Form:F,Field:L,Checkbox:q,Checkboxes:D,Image:M,Object:G,Range:ye,Select:je,Text:ve,Password:be},Oe=(ke=i({coerce:fe,getChoices:z,prepField:N,parseLazySchema:$,plugin:{install:e=>{console.warn("DEPRACATED: app.use(UrForm) is now preferred"),e.use(Oe)}}},Ce),t(ke,r({install:e=>{Object.entries(Ce).forEach((([t,r])=>e.component("Unrest"+t,r)))}})));var ke;export default Oe;
