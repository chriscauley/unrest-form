var e=Object.defineProperty,t=Object.defineProperties,r=Object.getOwnPropertyDescriptors,n=Object.getOwnPropertySymbols,l=Object.prototype.hasOwnProperty,o=Object.prototype.propertyIsEnumerable,i=(t,r,n)=>r in t?e(t,r,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[r]=n,a=(e,t)=>{for(var r in t||(t={}))l.call(t,r)&&i(e,r,t[r]);if(n)for(var r of n(t))o.call(t,r)&&i(e,r,t[r]);return e};import{reactive as s,resolveComponent as u,openBlock as d,createBlock as c,withModifiers as p,createVNode as m,Fragment as h,renderList as f,toDisplayString as v,renderSlot as b,createCommentVNode as g,resolveDynamicComponent as y,createTextVNode as _,withDirectives as V,mergeProps as j,vModelText as C,vModelDynamic as O}from"vue";import{validate as k}from"jsonschema";const w=e=>{const t={};return Object.entries(e).forEach((([e,r])=>{if(null==r||""===r)return;if(r.constructor!==Object)return void(t[e]=r);const n=w(r);Object.keys(n).length>0&&(t[e]=n)})),t};const x=(e,t)=>{if("object"===t.type)return e=e||{},Object.entries(t.properties).forEach((([t,r])=>{e[t]=x(e[t],r)})),e;const r=e||t.default;return["integer","number"].includes(t.type)?isNaN(Number(r))?r:Number(r):r};var E=e=>(e=e.replace(/([A-Z])/g," $1").toLowerCase().replace(/_/g," "))[0].toUpperCase()+e.slice(1);const A=["number","string","boolean"],$=e=>{if(null==e)return{};for(let t=0;t<A.length;t++)if(typeof e===A[t])return{default:e,type:A[t]};if(Array.isArray(e))return{type:"array",default:e,items:$(e[0])};if("lazy"===e.type){const t={};return Object.entries(e).forEach((([e,r])=>t[e]=$(r))),delete t.type,{type:"object",properties:t}}if(e.type)return e;throw"Unrecognized schema object for parseLazySchema"},I=e=>"object"===e.type?"unrest-object":e.enum?"unrest-select":"boolean"===e.type?"unrest-checkbox":"image"===e.type?"unrest-image":"color"===e.format?"unrest-color":"password"===e.format?"unrest-password":"HiddenInput"===e.__widget?"unrest-hidden":"unrest-text";var N=(e,t,{ui:r={}}={},i=[])=>{var a=((e,t)=>{var r={};for(var i in e)l.call(e,i)&&t.indexOf(i)<0&&(r[i]=e[i]);if(null!=e&&n)for(var i of n(e))t.indexOf(i)<0&&o.call(e,i)&&(r[i]=e[i]);return r})(t,[]);return"lazy"===a.type&&(a=$(a)),a.name=e,a.id=`id__${a.name}`,a.ui=((e,t)=>{const r={type:"text",tagName:I(e)};return"number"===e.type&&(r.type="number"),"password"===e.format&&(r.type="password"),"email"===e.format&&(r.type="email"),Object.assign(r,t[e.name],e.ui)})(a,r),void 0===a.title&&(a.title=E(a.name)),a.__path=i.slice(),"__root"!==e&&a.__path.push(a.name),a};const F={provide(){return{ur_form:this}},props:{schema:Object,ui:Object,state:{type:Object,default:()=>s({})},onError:Function,onSubmit:Function,onChange:Function,onInput:Function,errors:Object,focus:{type:Boolean,default:()=>!0},onCancel:Function},emits:["error"],data:()=>({internal_errors:null,loading:!1}),computed:{computed_errors(){const e=a(a({},this.errors),this.internal_errors);return e.__all__&&(e.__root=e.__all__),e.__root&&!Array.isArray(e.__root)&&(e.__root=[e.__root]),e},prepped_schema(){return N("__root",this.schema)}},beforeMount(){x(this.state,this.prepped_schema)},mounted(){var e;this.focus&&(null==(e=this.$el.querySelector("input"))||e.focus())},methods:{setErrors(e){this.internal_errors=e,e&&this.$emit("error",e)},handleError(e){var t,r,n,l;throw this.loading=!1,e.message&&this.setErrors({__root:e.message||e}),(null==(r=null==(t=e.response)?void 0:t.data)?void 0:r.errors)&&this.setErrors(null==(l=null==(n=e.response)?void 0:n.data)?void 0:l.errors),e},change(e){var t;null==(t=this.onChange)||t.call(this,this.state,e)},input(e){var t;null==(t=this.onInput)||t.call(this,this.state,e)},submit(e){var t;if(!this.loading){if(this.setErrors(((e,t)=>{const r=k(w(e),t);if(!r.errors.length)return null;const n={};return r.errors.forEach((({path:e,argument:t,message:r,name:l})=>{e=[...e,t],n[e.join(".")]="required"===l?"This field is required.":r})),n})(this.state,this.prepped_schema)),this.internal_errors)return console.error(this.state),void console.error(this.internal_errors);try{this.loading=!0,Promise.resolve(null==(t=this.onSubmit)?void 0:t.call(this,this.state,e)).then((e=>(this.loading=!1,e))).catch(this.handleError)}catch(r){this.handleError(r)}}}}},U={class:"ur-form__actions"},S=m("button",{type:"submit",class:"btn -primary"},"Submit",-1);F.render=function(e,t,r,n,l,o){var i;const a=u("unrest-field");return d(),c("form",{onSubmit:t[3]||(t[3]=p(((...e)=>o.submit&&o.submit(...e)),["prevent"])),class:["ur-form",e.loading&&"-loading"]},[m(a,{modelValue:r.state,"onUpdate:modelValue":t[1]||(t[1]=e=>r.state=e),field:o.prepped_schema,key:o.prepped_schema.id,onChange:o.change,onInput:o.input},null,8,["modelValue","field","onChange","onInput"]),(d(!0),c(h,null,f(null==(i=o.computed_errors)?void 0:i.__root,((e,t)=>(d(),c("div",{key:t,class:"form-error"},v(e.message||e),1)))),128)),m("div",U,[b(e.$slots,"actions",{},(()=>[r.onCancel?(d(),c("div",{key:0,type:"cancel",class:"btn -secondary",onClick:t[2]||(t[2]=(...e)=>r.onCancel&&r.onCancel(...e))},"Cancel")):g("",!0),S,b(e.$slots,"extra_actions")]))])],34)};const L={inject:["ur_form"],props:{field:Object,form:Object,modelValue:null},emits:["update:modelValue"],computed:{error(){var e;let t=null==(e=this.ur_form.internal_errors)?void 0:e[this.field.__path.join(".")];return Array.isArray(t)&&(t=t[0]),(null==t?void 0:t.message)&&(t=t.message),t},css(){return{root:[`form-group form-group__${this.field.name}`,{"-error":this.error}]}}},methods:{showLabel:e=>e.title&&"__root"!==e.name&&!["unrest-checkbox"].includes(e.ui.tagName)}},P={class:"input-wrapper"},R={key:1,class:"form-error"},T={key:2,class:"description"};L.render=function(e,t,r,n,l,o){return"unrest-hidden"!==r.field.ui.tagName?(d(),c("div",{key:0,class:o.css.root},[o.showLabel(r.field)?(d(),c("label",{key:0,for:r.field.id},v(r.field.title),9,["for"])):g("",!0),m("div",P,[(d(),c(y(r.field.ui.tagName),{field:r.field,modelValue:r.modelValue,"onUpdate:modelValue":t[1]||(t[1]=t=>e.$emit("update:modelValue",t))},null,8,["field","modelValue"]))]),o.error?(d(),c("div",R,v(o.error),1)):r.field.description?(d(),c("div",T,v(r.field.description),1)):g("",!0)],2)):g("",!0)};const q={props:{modelValue:null,field:Object},emits:["update:modelValue"],computed:{mixed(){return"mixed"===this.modelValue},css(){const{mixed:e}=this,{disabled:t}=this.field;return[this.field.ui.css,"ur-checkbox -"+this.icon,{"-mixed":e,"-disabled":t}]},icon(){return this.mixed?"indeterminate":this.modelValue?"checked":"unchecked"}},methods:{onChange(){this.field.disabled||this.$emit("update:modelValue",!this.modelValue)}}};q.render=function(e,t,r,n,l,o){return d(),c("label",{class:o.css},[m("input",{type:"checkbox",id:r.field.id,checked:r.modelValue,onInput:t[1]||(t[1]=(...e)=>o.onChange&&o.onChange(...e)),name:r.field.name},null,40,["id","checked","name"]),_(" "+v(r.field.title),1)],2)};const z={props:{modelValue:null,field:Object},emits:["update:modelValue"],computed:{choices(){const e=(e=>{if(e.getChoices)return e.getChoices();const t=e.enumNames||e.enum;return e.enum.map(((e,r)=>({value:e,name:t[r]})))})(this.field),{disabled:t}=this.field;return e.forEach((e=>{var r;e.checked=null==(r=this.modelValue)?void 0:r.includes(e.value),e.class=["ur-checkbox",e.checked?"-checked":"-unchecked",t&&"-disabled"]})),e}},methods:{change(){this.field.disabled||this.$emit("update:modelValue",this.choices.filter((e=>e.checked)))}}};z.render=function(e,t,r,n,l,o){return d(),c("div",null,[(d(!0),c(h,null,f(o.choices,((t,n)=>(d(),c("label",{class:t.class,key:n},[m("input",{type:"checkbox",checked:e.isChecked[t.value],onInput:()=>o.change(t.value),name:t.name},null,40,["checked","onInput","name"]),_(" "+v(r.field.title),1)],2)))),128))])};const D={props:{modelValue:null,field:Object},emits:["update:modelValue"],data(){return{original:this.modelValue}},computed:{name(){var e,t,r;return(null==(e=this.modelValue)?void 0:e.name)||(null==(r=null==(t=this.modelValue)?void 0:t.split)?void 0:r.call(t,"/").pop())},css(){var e,t;return[null==(t=null==(e=this.field)?void 0:e.ui)?void 0:t.css,"ur-file"]},src(){var e;return(null==(e=this.modelValue)?void 0:e.dataURL)||this.modelValue},required:()=>!1},methods:{set(e){this.$emit("update:modelValue",e);const t=document.createEvent("HTMLEvents");t.initEvent("change",!0,!0),this.$el.dispatchEvent(t)},onChange(e){const t=this.$refs.input.files[0];if(!t)return;const r=new FileReader;r.addEventListener("load",(()=>{const n={dataURL:r.result,name:t.name};this.$emit("update:modelValue",n),this.$refs.input.value="",this.$el.dispatchEvent(e)}),!1),r.readAsDataURL(t)}}},M={class:"name"},B=m("div",{class:"btn -primary"}," Choose File ",-1);D.render=function(e,t,r,n,l,o){return d(),c("label",{for:r.field.id,class:o.css},[m("input",{style:{display:"none"},type:"file",id:r.field.id,onChange:t[1]||(t[1]=p(((...e)=>o.onChange&&o.onChange(...e)),["stop"])),ref:"input"},null,40,["id"]),m("div",null,[r.modelValue?(d(),c("img",{key:0,src:o.src},null,8,["src"])):g("",!0)]),m("div",null,[m("div",M,v(o.name),1),l.original&&l.original!==r.modelValue?(d(),c("div",{key:0,class:"fa fa-undo cursor-pointer",onClick:t[2]||(t[2]=p((e=>o.set(l.original)),["prevent"])),title:"Revert to original value",role:"button"})):g("",!0),o.src&&!o.required?(d(),c("div",{key:1,class:"fa fa-trash",onClick:t[3]||(t[3]=e=>o.set(null))})):g("",!0),B])],10,["for"])};const H={inject:["ur_form"],props:{field:Object,modelValue:Object},computed:{children(){return Object.entries(this.field.properties).map((([e,t])=>N(e,t,this.ur_form,this.field.__path)))}}};H.render=function(e,t,r,n,l,o){const i=u("unrest-field");return d(!0),c(h,null,f(o.children,(e=>(d(),c(i,{key:e.id,field:e,modelValue:r.modelValue[e.name],"onUpdate:modelValue":t=>r.modelValue[e.name]=t},null,8,["field","modelValue","onUpdate:modelValue"])))),128)};var G="undefined"!=typeof globalThis?globalThis:"undefined"!=typeof window?window:"undefined"!=typeof global?global:"undefined"!=typeof self?self:{},Z="[object GeneratorFunction]",J="object"==typeof G&&G&&G.Object===Object&&G,K="object"==typeof self&&self&&self.Object===Object&&self,Q=J||K||Function("return this")();function W(e,t,r){switch(r.length){case 0:return e.call(t);case 1:return e.call(t,r[0]);case 2:return e.call(t,r[0],r[1]);case 3:return e.call(t,r[0],r[1],r[2])}return e.apply(t,r)}function X(e,t){for(var r=-1,n=t.length,l=e.length;++r<n;)e[l+r]=t[r];return e}var Y=Object.prototype,ee=Y.hasOwnProperty,te=Y.toString,re=Q.Symbol,ne=Y.propertyIsEnumerable,le=re?re.isConcatSpreadable:void 0,oe=Math.max;function ie(e,t,r,n,l){var o=-1,i=e.length;for(r||(r=ae),l||(l=[]);++o<i;){var a=e[o];t>0&&r(a)?t>1?ie(a,t-1,r,n,l):X(l,a):n||(l[l.length]=a)}return l}function ae(e){return ue(e)||function(e){return function(e){return de(e)&&function(e){return null!=e&&function(e){return"number"==typeof e&&e>-1&&e%1==0&&e<=9007199254740991}(e.length)&&!function(e){var t=function(e){var t=typeof e;return!!e&&("object"==t||"function"==t)}(e)?te.call(e):"";return"[object Function]"==t||t==Z}(e)}(e)}(e)&&ee.call(e,"callee")&&(!ne.call(e,"callee")||"[object Arguments]"==te.call(e))}(e)||!!(le&&e&&e[le])}function se(e){if("string"==typeof e||function(e){return"symbol"==typeof e||de(e)&&"[object Symbol]"==te.call(e)}(e))return e;var t=e+"";return"0"==t&&1/e==-Infinity?"-0":t}var ue=Array.isArray;function de(e){return!!e&&"object"==typeof e}var ce,pe,me=(ce=function(e,t){return null==e?{}:function(e,t){return function(e,t,r){for(var n=-1,l=t.length,o={};++n<l;){var i=t[n],a=e[i];r(a,i)&&(o[i]=a)}return o}(e=Object(e),t,(function(t,r){return r in e}))}(e,function(e,t){for(var r=-1,n=e?e.length:0,l=Array(n);++r<n;)l[r]=t(e[r],r,e);return l}(ie(t,1),se))},pe=oe(void 0===pe?ce.length-1:pe,0),function(){for(var e=arguments,t=-1,r=oe(e.length-pe,0),n=Array(r);++t<r;)n[t]=e[pe+t];t=-1;for(var l=Array(pe+1);++t<pe;)l[t]=e[t];return l[pe]=n,W(ce,this,l)}),he=(e,t={})=>"number"===t.type||"integer"===t.type?""===e?NaN:Number(e):"array"===t.type&&"string"==typeof e?e.split(t.delimiter||",").map((e=>e.trim())).filter(Boolean):e;const fe={props:{modelValue:null,field:Object},emits:["update:modelValue"],data(){return{showError:!1,value:this.modelValue}},watch:{modelValue(){this.value=this.modelValue}},computed:{inputAttrs(){const e=me(this.field,["name","disabled","placeholder","id","readOnly"]);return e.type=this.field.ui.type,e.class="form-control",e},textarea(){return"Textarea"===this.field.__widget}},methods:{onChange(){const e=he(this.value,this.field);"number"===this.field.type&&isNaN(e)||this.$emit("update:modelValue",e)}}};fe.render=function(e,t,r,n,l,o){return o.textarea?V((d(),c("textarea",j({key:0},o.inputAttrs,{"onUpdate:modelValue":t[1]||(t[1]=e=>l.value=e),onInput:t[2]||(t[2]=(...e)=>o.onChange&&o.onChange(...e))}),null,16)),[[C,l.value]]):V((d(),c("input",j({key:1},o.inputAttrs,{"onUpdate:modelValue":t[3]||(t[3]=e=>l.value=e),onInput:t[4]||(t[4]=(...e)=>o.onChange&&o.onChange(...e))}),null,16)),[[O,l.value]])};const ve={mixins:[fe],data:()=>({show_password:!1}),computed:{iconClass(){return"input-group-append cursor-pointer fa fa-eye"+(this.show_password?"-slash":"")},type(){return this.show_password?"text":"password"}}},be={class:"input-group"};ve.render=function(e,t,r,n,l,o){return d(),c("div",be,[V(m("input",j(e.inputAttrs,{onInput:t[1]||(t[1]=(...t)=>e.onChange&&e.onChange(...t)),"onUpdate:modelValue":t[2]||(t[2]=t=>e.value=t),class:"form-control",type:o.type}),null,16,["type"]),[[O,e.value]]),m("i",{class:o.iconClass,onClick:t[3]||(t[3]=e=>l.show_password=!l.show_password)},null,2)])};const ge={props:{field:Object,modelValue:Number},emits:["update:modelValue"],computed:{inputAttrs(){return me(this.field.ui,["min","max","step"])}},methods:{change(e){this.$emit("update:modelValue",Number(e.target.value))}}},ye={class:"ur-range"},_e={class:"ur-range__value"};ge.render=function(e,t,r,n,l,o){return d(),c("div",ye,[m("input",j({type:"range"},o.inputAttrs,{onInput:t[1]||(t[1]=(...e)=>o.change&&o.change(...e)),onChange:t[2]||(t[2]=(...e)=>o.change&&o.change(...e)),value:r.modelValue}),null,16,["value"]),m("div",_e,v(r.modelValue),1)])};const Ve={props:{modelValue:null,field:Object,form:Object},emits:["update:modelValue"],computed:{choices(){if(this.field.getChoices)return this.field.getChoices();const e=this.field.enumNames||this.field.enum,t=this.field.enum.map(((t,r)=>({value:t,name:e[r]})));return this.field.placeholder&&t.unshift({name:this.field.placeholder,value:""}),t}},methods:{onChange(e){const t=he(e.target.value,this.field);this.$emit("update:modelValue",t)}}};Ve.render=function(e,t,r,n,l,o){return d(),c("select",{onInput:t[1]||(t[1]=(...e)=>o.onChange&&o.onChange(...e)),value:r.modelValue,id:r.field.id,class:"form-control"},[(d(!0),c(h,null,f(o.choices,(e=>(d(),c("option",{value:e.value,key:e.name},v(e.name),9,["value"])))),128))],40,["value","id"])};const je={Form:F,Field:L,Checkbox:q,Checkboxes:z,Image:D,Object:H,Range:ge,Select:Ve,Text:fe,Password:ve},Ce=(Oe=a({prepField:N,parseLazySchema:$,plugin:{install:e=>{console.warn("DEPRACATED: app.use(UrForm) is now preferred"),e.use(Ce)}}},je),t(Oe,r({install:e=>{Object.entries(je).forEach((([t,r])=>e.component("Unrest"+t,r)))}})));var Oe;export default Ce;
